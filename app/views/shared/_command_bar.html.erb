<div data-controller="command-bar" data-command-bar-open-value="false" data-command-bar-mode-value="search">
  <%# Backdrop %>
  <div data-command-bar-target="backdrop" data-action="click->command-bar#close"
       class="hidden fixed inset-0 bg-black/50 z-[300]"></div>

  <%# Centering wrapper %>
  <div data-command-bar-target="dialog"
       class="hidden fixed inset-0 z-[301] flex items-start justify-center pt-[15vh] pointer-events-none">
    <%# Command bar container %>
    <div class="w-[520px] max-w-[calc(100vw-2rem)] max-h-[65vh] flex flex-col pointer-events-auto overflow-hidden animate-drop-in"
         style="background:#1e1e22;border-radius:16px;border:1px solid rgba(255,255,255,0.08);box-shadow:0 32px 80px rgba(0,0,0,0.5)">

      <%# Input bar %>
      <div class="flex items-center gap-2.5" style="padding:14px 18px;border-bottom:1px solid rgba(255,255,255,0.06)">
        <%# Mode icon %>
        <div data-command-bar-target="modeIcon" class="flex-shrink-0 flex items-center justify-center">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none" style="opacity:0.3">
            <circle cx="7" cy="7" r="5" stroke="#888" stroke-width="1.5"/>
            <path d="M11 11L14 14" stroke="#888" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
        </div>
        <%# Input %>
        <input type="text"
               data-command-bar-target="input"
               data-action="input->command-bar#onInput keydown->command-bar#onInputKeydown"
               placeholder="Search cards, ask agent, or take an action..."
               class="flex-1 bg-transparent border-none text-sm font-medium text-[#e0e0e0] placeholder-[#555] focus:outline-none focus:ring-0"
               style="font-family:inherit" />
        <%# Back button (agent mode only) %>
        <button type="button"
                data-command-bar-target="backButton"
                data-action="click->command-bar#switchToSearch"
                class="hidden cursor-pointer"
                style="font-size:10px;font-weight:600;color:#555;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.06);padding:3px 8px;border-radius:5px">Back</button>
        <%# Esc badge %>
        <span style="font-size:10px;font-weight:600;color:#333;background:rgba(255,255,255,0.03);padding:3px 7px;border-radius:5px">esc</span>
      </div>

      <%# Body (scrollable) %>
      <div data-command-bar-target="body" class="flex-1 overflow-y-auto" style="padding:6px 0">

        <%# Search results (hidden by default) %>
        <div data-command-bar-target="searchResults" class="hidden"></div>

        <%# Quick actions (shown by default in search mode) %>
        <div data-command-bar-target="actionsPanel" style="padding:4px 8px">
          <div style="font-size:10px;font-weight:700;color:#444;text-transform:uppercase;letter-spacing:0.06em;padding:6px 10px">Actions</div>

          <% [
            ["add", "+", "Add new card", "Create a task"],
            ["agent", "ðŸ¤–", "Ask agent", "Get help from AI"],
            ["today", "â˜€ï¸", "What should I focus on?", "Agent prioritizes"],
            ["breakdown", "ðŸ“‹", "Break down a task", "Split into subtasks"],
            ["draft", "âœï¸", "Draft content", "Write posts, emails"],
            ["recap", "ðŸ“Š", "Weekly recap", "Summary of progress"],
          ].each do |action_id, icon, label, hint| %>
            <button type="button"
                    data-action="click->command-bar#executeAction"
                    data-action-id="<%= action_id %>"
                    class="flex items-center gap-2.5 w-full rounded-lg cursor-pointer border-none bg-transparent hover:bg-white/[0.04] transition-colors"
                    style="padding:9px 10px;text-align:left">
              <div class="flex items-center justify-center flex-shrink-0" style="width:28px;height:28px;border-radius:7px;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.05);font-size:13px">
                <%= icon %>
              </div>
              <div class="flex-1">
                <div style="font-size:13px;font-weight:600;color:#ccc"><%= label %></div>
              </div>
              <span style="font-size:10px;font-weight:500;color:#333"><%= hint %></span>
            </button>
          <% end %>
        </div>

        <%# Agent panel (hidden by default) %>
        <div data-command-bar-target="agentPanel" class="hidden">
          <div data-command-bar-target="agentMessages" class="flex flex-col gap-2" style="padding:8px 16px">
            <%# Empty state rendered by JS %>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>
