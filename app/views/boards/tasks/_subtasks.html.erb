<%# Subtask list partial â€” used by Turbo Stream responses from SubtasksController %>
<% subtasks = task.subtasks.reload %>
<% board_color_hex = board_hex_color(board) %>
<% done_count = subtasks.count(&:done?) %>
<% total_count = subtasks.size %>
<% progress = total_count > 0 ? (done_count.to_f / total_count * 100).round : 0 %>

<div id="task_<%= task.id %>_subtasks" style="display:flex;flex-direction:column;gap:3px">
  <% subtasks.each do |subtask| %>
    <%= button_to board_task_subtask_path(board, task, subtask),
        method: :patch,
        params: { subtask: { done: !subtask.done? } },
        style: "display:flex;align-items:center;gap:10px;padding:8px 10px;border-radius:8px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.04);cursor:pointer" do %>
      <% if subtask.done? %>
        <div style="width:16px;height:16px;border-radius:4px;background:<%= board_color_hex %>;display:flex;align-items:center;justify-content:center;flex-shrink:0">
          <svg width="9" height="9" viewBox="0 0 16 16" fill="none"><path d="M3 8.5L6.5 12L13 4" stroke="#fff" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </div>
      <% else %>
        <div style="width:16px;height:16px;border-radius:4px;border:1.5px solid rgba(255,255,255,0.15);background:transparent;flex-shrink:0"></div>
      <% end %>
      <span style="font-size:12.5px;font-weight:500;color:<%= subtask.done? ? '#444' : '#bbb' %>;<%= 'text-decoration:line-through' if subtask.done? %>"><%= subtask.title %></span>
    <% end %>
  <% end %>
</div>
